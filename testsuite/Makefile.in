CFLAGS=-I../m4ri -D_XOPEN_SOURCE=600 @CFLAGS@
CC = @CC@

STAGEDIR:=$(PWD)/../.libs
LDFLAGS=-L$(STAGEDIR) -Wl,-rpath,$(STAGEDIR) -lm4ri
DEBUG=-ggdb

TEST_PRGS=test_elimination \
	test_multiplication \
	test_trsm test_pluq \
	test_solve test_kernel

BENCH_PRGS=bench_elimination \
	bench_multiplication \
	bench_pluq \
	bench_trsm_lowerleft \
	bench_trsm_upperleft \
	bench_trsm_lowerright \
	bench_trsm_upperright \
	bench_elimination_sparse

CPUCYCLES_DIR=./cpucycles-20060326

.PHONY: all clean dist-clean

all: $(TEST_PRGS) $(BENCH_PRGS)

bench_%: benchmarketing.h cpucycles.o bench_%.c Makefile
	$(CC) $(DEBUG) $(CFLAGS) $@.c cpucycles.o $(LDFLAGS) -o $@

test_%: test_%.c Makefile
	$(CC) $(DEBUG) $(CFLAGS) $@.c $(LDFLAGS) -o $@

matops: matops.c Makefile
	$(CC) $(DEBUG) -I.. $(CFLAGS) matops.c $(LDFLAGS) -o $@

clean:
	rm -f $(TEST_PRGS)
	rm -f $(BENCH_PRGS)
	rm -f *.o cpucycles.h
	rm -f $(CPUCYCLES_DIR)/cpucycles.o
	rm -f $(CPUCYCLES_DIR)/cpucycles.h

distclean: clean
	rm -f Makefile

cpucycles.h: cpucycles.o

cpucycles.o:
	(cd $(CPUCYCLES_DIR); sh do; cp cpucycles.o ..; cp cpucycles.h ..; cd ..)

Makefile: Makefile.in ../config.status
	(cd .. && /bin/sh ./config.status testsuite/Makefile)
